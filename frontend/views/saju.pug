// views/saju.pug
doctype html
html(lang="ko")
    head
        meta(charset='utf-8')
        title ì‚¬ì£¼ ìš´ì„¸ ë¶„ì„
        meta(name='viewport', content='width=device-width, initial-scale=1')
        
        link(rel='stylesheet', href='https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css')
        link(rel='preconnect', href='https://fonts.googleapis.com')
        link(rel='preconnect', href='https://fonts.gstatic.com', crossorigin)
        link(href='https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap', rel='stylesheet')

        style.
            body { font-family: 'Noto Sans KR', sans-serif; background-color: #f8f9fa; color: #343a40; }
            .header { background-color: #ffffff; padding: 2rem 0; border-bottom: 1px solid #dee2e6; margin-bottom: 2rem; }
            .saju-container { background-color: #ffffff; border-radius: 15px; padding: 2rem 2.5rem; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.07); margin-bottom: 2rem; }
            .result-box { border: 2px solid #007bff; padding: 20px; border-radius: 10px; background-color: #e9f7ff; }

    body
        .header
            .container.text-center
                h1: a(href='/') MBTI & Saju
                div.mt-2
                    a(href='/').text-muted.mr-3 MBTI ë°©ëª…ë¡
                    a(href='/saju').text-muted ì‚¬ì£¼ ìš´ì„¸ ì¡°íšŒ

        .container
            .saju-container
                h2.mb-4 ì‚¬ì£¼ ìš´ì„¸ ì¡°íšŒ
                
                // --- 1. ì…ë ¥ í¼ (ì´ë¦„, ìƒë…„ì›”ì¼, ì‹œê°„ ì…ë ¥) ---
                form(action="/saju-analyze", method="POST")
                    h4.mb-3 ìƒë…„ì›”ì¼ì‹œ ì •ë³´ ì…ë ¥
                    
                    // ì´ë¦„ ì…ë ¥
                    .form-group
                        label(for="name") ì´ë¦„
                        input#name.form-control(type="text", name="name", placeholder="í™ê¸¸ë™", required)
                        
                    // ìƒë…„ì›”ì¼ (ë…„, ì›”, ì¼) ì…ë ¥
                    .row.mb-3
                        .col-md-4.form-group
                            label(for="year") ì–‘ë ¥ ë…„ (YYYY)
                            input#year.form-control(type="number", name="year", placeholder="1990", required, min="1900", max="2100")
                        .col-md-4.form-group
                            label(for="month") ì›” (MM)
                            input#month.form-control(type="number", name="month", placeholder="1", required, min="1", max="12")
                        .col-md-4.form-group
                            label(for="day") ì¼ (DD)
                            input#day.form-control(type="number", name="day", placeholder="1", required, min="1", max="31")
                            
                    // íƒœì–´ë‚œ ì‹œê°„ ì…ë ¥
                    .form-group
                        label(for="hour") íƒœì–´ë‚œ ì‹œê°„ (24ì‹œê°„ì œ, 0~23ì‹œ)
                        input#hour.form-control(type="number", name="hour", placeholder="12", required, min="0", max="23")
                    
                    button.btn.btn-primary.mt-3(type="submit") ì‚¬ì£¼ ë¶„ì„í•˜ê¸°

                hr.my-5

                // --- 2. ë¶„ì„ ê²°ê³¼ ì˜ì—­ ---
                h3.mb-3 ë¶„ì„ ê²°ê³¼

                if error
                    .alert.alert-danger #{error}
                else if sajuResult && sajuResult.ganji
                    .result-box
                        // ì‚¬ìš©ì ì…ë ¥ ì •ë³´ í‘œì‹œ
                        p.lead.font-weight-bold #{sajuResult.name} ë‹˜ì˜ ì‚¬ì£¼ íŒ”ì
                        
                        // DBì—ì„œ ê°€ì ¸ì˜¨ ê°„ì§€ ì •ë³´ í‘œì‹œ
                        p ê°„ì§€ ì •ë³´ (ë§Œì„¸ë ¥ ê¸°ë°˜):
                        ul.list-unstyled
                            li ë…„ì£¼: #{sajuResult.ganji.year}
                            li ì›”ì£¼: #{sajuResult.ganji.month}
                            li ì¼ì£¼: #{sajuResult.ganji.day}
                            li ì‹œì£¼: #{sajuResult.ganji.hour}
                        
                        if sajuResult.interpretation
                            hr.my-4
                            h5.font-weight-bold ğŸ”® GPT ìš´ì„¸ í’€ì´
                            p(style="white-space: pre-wrap;") #{sajuResult.interpretation}
                    //- .alert.alert-info.mt-3
                    //-     | #{sajuResult.message}           
                else
                    .alert.alert-secondary
                        | ìƒë…„ì›”ì¼ì‹œë¥¼ ì…ë ¥í•˜ê³  ë¶„ì„ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.
        
        // ... (ìŠ¤í¬ë¦½íŠ¸ ë§í¬)
        script(src='https://code.jquery.com/jquery-3.5.1.slim.min.js')
        script(src='https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js')
        script(src='https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js')
