doctype html
html(lang="ko")
    head
        meta(charset='utf-8')
        title MBTI Guestbook
        meta(name='viewport' content='width=device-width, initial-scale=1')
        
        link(rel='stylesheet' href='https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css')
        link(rel='preconnect' href='https://fonts.googleapis.com')
        link(rel='preconnect' href='https://fonts.gstatic.com', crossorigin)
        link(href='https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap' rel='stylesheet')

        style.
            body { font-family: 'Noto Sans KR', sans-serif; background-color: #f8f9fa; color: #343a40; }
            .header { background-color: #ffffff; padding: 2rem 0; border-bottom: 1px solid #dee2e6; margin-bottom: 2rem; }
            .test-container { background-color: #ffffff; border-radius: 15px; padding: 2rem 2.5rem; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.07); margin-bottom: 2rem; }
            .question-block { margin-bottom: 1.75rem; }
            .card { border-radius: 15px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05); border: none; }
            .modal-content { border-radius: 15px; }

    body
        .header
            .container.text-center
                h1: a(href='/') ÎãπÏã†Ïùò MBTIÎ•º ÎÇ®Í≤®Ï£ºÏÑ∏Ïöî
                div.mt-2
                    a(href='/saju').text-muted.mr-3 ÏÇ¨Ï£º Î≥¥Í∏∞
                    button#showResultBtn.btn.btn-sm.btn-outline-info(type="button" style="display:none;") ÎÇ¥ Í≤∞Í≥º Îã§ÏãúÎ≥¥Í∏∞
                    button#debugFillBtn.btn.btn-sm.btn-warning.mt-2(type="button") [Debug: Auto-Fill]

        .container
            .test-container
                form#mbtiForm(action="/post" method="POST")
                    .d-flex.justify-content-between.align-items-center.mb-2
                        h5 ÏßÑÌñâ ÏÉÅÌô©
                        h5#questionCounter (0 / 100)
                    .progress.mb-4(style="height: 20px;")
                        #progressBar.progress-bar.bg-success.progress-bar-striped.progress-bar-animated(role="progressbar" style="width: 0%;") 0%
                    
                    hr.my-4
                    -
                        let q_index = 0;

                    //- 'questions' Î≥ÄÏàòÎäî app.jsÏóêÏÑú res.renderÎ°ú Ï†ÑÎã¨Îêú Îç∞Ïù¥ÌÑ∞ÏûÖÎãàÎã§.
                    each categoryQuestions, category in questions
                        fieldset.my-4
                            legend.h5.mb-3 #{category}
                            each question in categoryQuestions
                                - q_index++
                                .question-block
                                    p #{q_index}. #{question}
                                    .btn-group.btn-group-toggle(data-toggle="buttons")
                                        label.btn.btn-outline-secondary
                                            input(type="radio", name=`q${q_index}`, value="-2", required)
                                            span Îß§Ïö∞ ÏïÑÎãàÎã§
                                        label.btn.btn-outline-secondary
                                            input(type="radio", name=`q${q_index}`, value="-1")
                                            span ÏïÑÎãàÎã§
                                        label.btn.btn-outline-secondary
                                            input(type="radio", name=`q${q_index}`, value="0")
                                            span Î≥¥ÌÜµ
                                        label.btn.btn-outline-secondary
                                            input(type="radio", name=`q${q_index}`, value="1")
                                            span Í∑∏Î†áÎã§
                                        label.btn.btn-outline-secondary
                                            input(type="radio", name=`q${q_index}`, value="2")
                                            span Îß§Ïö∞ Í∑∏Î†áÎã§
                    
                    //- Ìèº Ï†ÑÏÜ° Ïãú DBÏóê Ï†ÄÏû•Îê† Ïà®Í≤®ÏßÑ ÌïÑÎìúÎì§
                    input(type="hidden" name="mbti" id="mbtiResultInput")
                    input(type="hidden" name="scoreE" id="scoreE")
                    input(type="hidden" name="scoreS" id="scoreS")
                    input(type="hidden" name="scoreT" id="scoreT")
                    input(type="hidden" name="scoreJ" id="scoreJ")
                    input(type="hidden", name="mbtiJob", id="mbtiJobInput")
                    input(type="hidden", name="mbtiImage", id="mbtiImageInput")
                    input(type="hidden", name="mbtiComment", id="mbtiCommentInput")
                    
                    hr.my-4

                    .text-center.mt-4
                        button#calculateBtn.btn.btn-info.btn-lg(type="button", disabled) Í≤∞Í≥º Î≥¥Í∏∞

                    div#final-inputs(style="display:none;")
                        hr.my-4
                        h5.text-center.mb-3 ÎßàÏßÄÎßâÏúºÎ°ú Ï†ïÎ≥¥Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.
                        .row.justify-content-center
                            .col-md-5.mb-3
                                .input-group
                                    .input-group-prepend
                                        span.input-group-text Writer
                                    input#name.form-control(type="text" name="name" placeholder="Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî", required)
                            .col-md-5.mb-3
                                .input-group
                                    .input-group-prepend
                                        span.input-group-text Date
                                    input#date.form-control(type="date" name="date", required)
                        .row.justify-content-center
                            .col-md-10.mb-3
                                .input-group
                                    .input-group-prepend
                                        span.input-group-text ÌïúÎßàÎîî
                                    input.form-control(type="text" name="memo" placeholder="Í≤∞Í≥ºÏóê ÎåÄÌïú ÏÜåÍ∞êÏùÑ ÎÇ®Í≤®Î≥¥ÏÑ∏Ïöî! (ÏÑ†ÌÉù)")
                        .row.justify-content-center
                            .col-md-10.mb-3
                                .input-group
                                    .input-group-prepend
                                        span.input-group-text ÌÉúÍ∑∏
                                    input.form-control(type="text" name="tags" placeholder="ÏâºÌëú(,)Î°ú Íµ¨Î∂ÑÌïòÏó¨ ÏûêÏã†ÏùÑ ÌëúÌòÑÌï¥Î≥¥ÏÑ∏Ïöî.")
                        .text-center.mt-4
                            button#submitBtn.btn.btn-primary.btn-lg(type="submit", disabled) Í≤∞Í≥º Ï†ÄÏû•ÌïòÍ∏∞
            hr

            section#post-list
                if messages && messages.length > 0
                    h2.text-center.mb-4 Î∞©Î¨∏Ïûê Í∏∞Î°ù
                    .row
                        each msg in messages
                            .col-md-6.col-lg-4.mb-4
                                .card
                                    .card-body
                                        h5.card-title #{msg.name}
                                        p.card-text.mt-3
                                            strong MBTI Í≤∞Í≥º: 
                                            span.badge.badge-success.p-2 #{msg.mbti}
                                        
                                        //- üåü [ÏàòÏ†ï] DBÏóê Ï†ÄÏû•Îêú ÏΩîÎ©òÌä∏ ÌëúÏãú
                                        if msg.mbtiComment
                                            p.card-text.font-italic.my-2(style="color: #555;") "#{msg.mbtiComment}"
                                        
                                        //- üåü [ÏàòÏ†ï] DBÏóê Ï†ÄÏû•Îêú Ïù¥ÎØ∏ÏßÄ/ÏßÅÏóÖ ÌëúÏãú
                                        if msg.mbtiImage
                                            img.card-img-top.mt-2.mb-2(src=msg.mbtiImage, alt=msg.mbti, style="max-height: 150px; object-fit: contain;")
                                        if msg.mbtiJob
                                            p.card-text
                                                strong Ï∂îÏ≤ú ÏßÅÏóÖ:
                                                span.text-muted #{msg.mbtiJob}
                                        
                                        if msg.memo
                                            p.card-text.font-italic.mt-2
                                                | "#{msg.memo}"
                                        if msg.tags && msg.tags.length > 0
                                            div.mt-2
                                                each tag in msg.tags
                                                    span.badge.badge-pill.badge-info.mr-1 #{tag}
                                        hr
                                        div.d-flex.justify-content-between.align-items-center
                                            small.text-muted #{new Date(msg.createdAt).toLocaleString('ko-KR', { timeZone: 'Asia/Seoul' })}
                                            div
                                                span.mr-1(id=`likes-count-${msg._id}`) #{msg.likes || 0}
                                                button.btn.btn-sm.btn-outline-danger.like-button(type="button", data-id=msg._id) ‚ù§Ô∏è
                else
                    .alert.alert-info(role='alert')
                        | ÏïÑÏßÅ Îì±Î°ùÎêú Î∞©Î™ÖÎ°ùÏù¥ ÏóÜÏäµÎãàÎã§.

        #resultModal.modal.fade(tabindex="-1" role="dialog")
            .modal-dialog.modal-dialog-centered(role="document")
                .modal-content
                    .modal-header
                        h5.modal-title üéâ ÎãπÏã†Ïùò MBTI Í≤∞Í≥ºÏûÖÎãàÎã§!
                        button.close(type="button" data-dismiss="modal"): span(aria-hidden="true") &times;
                    .modal-body.text-center
                        p.lead ÎãπÏã†Ïùò ÏÑ±Ìñ•ÏùÑ ÎÇòÌÉÄÎÇ¥Îäî Ïú†ÌòïÏùÄ...
                        h1#modalResultText.font-weight-bold
                        
                        //- üåü [ÏàòÏ†ï] ÏΩîÎ©òÌä∏ ÌëúÏãú ÏòÅÏó≠ Ï∂îÍ∞Ä
                        p#modalResultComment.lead.font-italic(style="color: #555;")
                        
                        //- üåü [ÏàòÏ†ï] Ïù¥ÎØ∏ÏßÄ/ÏßÅÏóÖ ÌëúÏãú ÏòÅÏó≠
                        img#modalResultImage.img-fluid.my-3(src="" alt="MBTI Ïú†Ìòï Ïù¥ÎØ∏ÏßÄ" style="max-height: 200px; display: none;")
                        h5.mt-3 Ïñ¥Ïö∏Î¶¨Îäî ÏßÅÏóÖ
                        p#modalResultJob.text-muted
                    .modal-footer
                        button.btn.btn-secondary(type="button" data-dismiss="modal") Îã´Í∏∞

        script(src='https://code.jquery.com/jquery-3.5.1.slim.min.js')
        script(src='https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js')
        script(src='https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js')

        script.
            document.addEventListener('DOMContentLoaded', () => {

                const mbtiData = {
                    'ISTJ': { image: '/img/ISTJ.png', occupations: 'ÌöåÍ≥ÑÏÇ¨, Îç∞Ïù¥ÌÑ∞ Î∂ÑÏÑùÍ∞Ä, ÌíàÏßà Í¥ÄÎ¶¨, Ïû¨Î¨¥ Í¥ÄÎ¶¨Ïûê, Í∞êÏ†ïÌèâÍ∞ÄÏÇ¨, ÌåêÏÇ¨', comment: 'Ï≤≠Î†¥Í≤∞Î∞±Ìïú ÎÖºÎ¶¨Ï£ºÏùòÏûê' },
                    'ISFJ': { image: '/img/ISFJ.png', occupations: 'HR, ÏÇ¨ÌöåÎ≥µÏßÄÏÇ¨, ÏÉÅÎã¥ÏÇ¨', comment: 'Ïö©Í∞êÌïú ÏàòÌò∏Ïûê, ÌóåÏã†Ï†ÅÏù∏ Ï°∞Î†•Ïûê' },
                    'INFJ': { image: '/img/INFJ.png', occupations: 'ÏΩòÌÖêÏ∏† Ï†ÑÎûµÍ∞Ä, UX Î¶¨ÏÑúÏ≤ò, ÎπÑÏòÅÎ¶¨ Í∏∞Ìöç, Îç∞Ïù¥ÌÑ∞ Í≥ºÌïôÏûê', comment: 'ÏÑ†ÏùòÏùò ÏòπÌò∏Ïûê' },
                    'INTJ': { image: '/img/INTJ.png', occupations: 'Îç∞Ïù¥ÌÑ∞ Í≥ºÌïôÏûê, ÏãúÏä§ÌÖú ÏïÑÌÇ§ÌÖçÌä∏, Ïó∞Íµ¨Ïõê', comment: 'Ïö©ÏùòÏ£ºÎèÑÌïú Ï†ÑÎûµÍ∞Ä' },
                    'ISTP': { image: '/img/ISTP.png', occupations: 'ÏãúÏä§ÌÖú ÏóîÏßÄÎãàÏñ¥, Î≥¥ÏïàÎ∂ÑÏÑùÍ∞Ä, Ï†ïÎπÑ/Ïú†ÏßÄÎ≥¥Ïàò', comment: 'ÎßåÎä• Ïû¨Ï£ºÍæº' },
                    'ISFP': { image: '/img/ISFP.png', occupations: 'ÌîÑÎ°úÏ†ùÌä∏ Îß§ÎãàÏ†Ä, Í∑∏ÎûòÌîΩ ÎîîÏûêÏù¥ÎÑà, ÏÇ¨ÏßÑÍ∞Ä, ÌîåÎ°úÎ¶¨Ïä§Ìä∏', comment: 'Ìò∏Í∏∞Ïã¨ ÎßéÏùÄ ÏòàÏà†Í∞Ä' },
                    'INFP': { image: '/img/INFP.png', occupations: 'ÏûëÍ∞Ä/ÏóêÎîîÌÑ∞, Ïã¨Î¶¨ÏÉÅÎã¥, Î∏åÎûúÎìú Í∏∞Ìöç, ÏΩòÌÖêÏ∏† ÌÅ¨Î¶¨ÏóêÏù¥ÌÑ∞', comment: 'Ïó¥Ï†ïÏ†ÅÏù∏ Ï§ëÏû¨Ïûê, Ïù¥ÏÉÅÏùÑ Ìñ•Ìïú ÌóåÏã†' },
                    'INTP': { image: '/img/INTP.png', occupations: 'Ïó∞Íµ¨Í∞úÎ∞ú, ÏÜåÌîÑÌä∏Ïõ®Ïñ¥ ÏóîÏßÄÎãàÏñ¥, Îç∞Ïù¥ÌÑ∞ ÏÇ¨Ïù¥Ïñ∏Ìã∞Ïä§Ìä∏, Í∏∞ÏóÖ ÏïÑÌÇ§ÌÖçÌä∏', comment: 'ÎÖºÎ¶¨Ï†ÅÏù∏ ÏÇ¨ÏÉâÍ∞Ä' },
                    'ESTP': { image: '/img/ESTP.png', occupations: 'ÏòÅÏóÖ, Ìä∏Î†àÏù¥Îçî, ÏùëÍ∏âÍµ¨Ï°∞/ÌòÑÏû•ÎåÄÏùë, Ïù¥Î≤§Ìä∏ Í∏∞Ìöç', comment: 'Î™®ÌóòÏùÑ Ï¶êÍ∏∞Îäî ÏÇ¨ÏóÖÍ∞Ä' },
                    'ESFP': { image: '/img/ESFP.png', occupations: 'ÎßàÏºÄÌÑ∞, ÏáºÌò∏Ïä§Ìä∏, Í≥µÏó∞/ÌñâÏÇ¨ Í∏∞Ìöç', comment: 'ÏûêÏú†Î°úÏö¥ ÏòÅÌòºÏùò Ïó∞ÏòàÏù∏' },
                    'ENFP': { image: '/img/ENFP.png', occupations: 'ÎßàÏºÄÌåÖ/Ï∫†ÌéòÏù∏ Í∏∞Ìöç, Î∏åÎûúÎìú/Ï∫†ÌéòÏù∏ Í∏∞Ìöç, HRD/Ï°∞ÏßÅÎ¨∏Ìôî, Ïä§ÌÉÄÌä∏ÏóÖ PM', comment: 'Ïû¨Í∏∞Î∞úÎûÑÌïú ÌôúÎèôÍ∞Ä' },
                    'ENTP': { image: '/img/ENTP.png', occupations: 'ÌÅ¨Î¶¨ÏóêÏù¥Ìã∞Î∏å ÎîîÎ†âÌÑ∞, ÏÇ¨ÏóÖÍ∞úÎ∞ú, ÌîÑÎ°úÏ†ùÌä∏ Îß§ÎãàÏ†Ä, Î≤§Ï≤òÏ∫êÌîºÌÉà', comment: 'Îú®Í±∞Ïö¥ ÎÖºÏüÅÏùÑ Ï¶êÍ∏∞Îäî Î≥ÄÎ°†Í∞Ä' },
                    'ESTJ': { image: '/img/ESTJ.png', occupations: 'Ïö¥ÏòÅ/ÏÉùÏÇ∞Í¥ÄÎ¶¨, ÌîÑÎ°úÏ†ùÌä∏ Îß§ÎãàÏ†Ä, Î¨ºÎ•ò/ÏÑúÌîåÎùºÏù¥, Ï¥ùÎ¨¥/ÌñâÏ†ï', comment: 'ÏóÑÍ≤©Ìïú Í¥ÄÎ¶¨Ïûê, ÏßàÏÑúÏùò ÏàòÌò∏Ïûê' },
                    'ESFJ': { image: '/img/ESFJ.png', occupations: 'Í≥†Í∞ùÍ¥ÄÎ¶¨/CS, HR, ÍµêÏßÅ/ÌïôÏÇ¨Ïö¥ÏòÅ, Î≥ëÏõêÌñâÏ†ï', comment: 'ÏÇ¨ÍµêÏ†ÅÏù∏ Ïô∏ÍµêÍ¥Ä' },
                    'ENFJ': { image: '/img/ENFJ.png', occupations: 'ÍµêÏú° Í∏∞Ìöç, Ïª§ÎÆ§ÎãàÏºÄÏù¥ÏÖò ÎîîÎ†âÌÑ∞, ÏΩîÏπò/Ïª®ÏÑ§ÌÑ¥Ìä∏, Ïª§ÎÆ§ÎãàÌã∞ Îß§ÎãàÏ†Ä', comment: 'Ï†ïÏùòÎ°úÏö¥ ÏÇ¨Ìöå Ïö¥ÎèôÍ∞Ä' },
                    'ENTJ': { image: '/img/ENTJ.png', occupations: 'Í≤ΩÏòÅÏª®ÏÑ§ÌÑ¥Ìä∏, Ï†ÑÎûµ/Í∏∞Ìöç, Í∏∞Ïà†ÏòÅÏóÖ', comment: 'ÎåÄÎã¥Ìïú ÌÜµÏÜîÏûê, ÎπÑÏ†ÑÏùÑ Ïã§ÌòÑÌïòÎäî Ï†ÑÎûµÍ∞Ä' },
                    'DEFAULT': { image: '', occupations: 'Ï†ïÎ≥¥ ÏóÜÏùå', comment: 'Ïú†ÌòïÏùÑ Î∂ÑÏÑù Ï§ëÏûÖÎãàÎã§.' }
                };

                const totalQuestions = 100; // üåü 100Î¨∏Ìï≠ Í∏∞Ï§Ä
                const mbtiForm = document.getElementById('mbtiForm');
                const debugFillBtn = document.getElementById('debugFillBtn');
                const progressBar = document.getElementById('progressBar');
                const nameInput = document.getElementById('name');
                const dateInput = document.getElementById('date');
                const mbtiResultInput = document.getElementById('mbtiResultInput');
                const calculateBtn = document.getElementById('calculateBtn');
                const finalInputs = document.getElementById('final-inputs');
                const submitBtn = document.getElementById('submitBtn');
                const showResultBtn = document.getElementById('showResultBtn');
                const modalResultText = document.getElementById('modalResultText');
                const questionCounter = document.getElementById('questionCounter');

                const allRadios = document.querySelectorAll('input[type="radio"]');
                allRadios.forEach(radio => {
                    radio.addEventListener('click', () => {
                        updateProgress();
                        checkCompletion();
                    });
                });
                
                nameInput.addEventListener('input', checkCompletion);
                dateInput.addEventListener('input', checkCompletion);

                if (localStorage.getItem('userMBTI')) {
                    showResultBtn.style.display = 'inline-block';
                }
                
                // ÎîîÎ≤ÑÍ∑∏ Î≤ÑÌäº (Î™®Îëê 'Îß§Ïö∞ Í∑∏Î†áÎã§' ÏÑ†ÌÉù)
                debugFillBtn.addEventListener('click', () => {
                    console.log('[DEBUG] Auto-filling all questions...');
                    for (let i = 1; i <= totalQuestions; i++) {
                        const radioToSelect = document.querySelector(`input[name="q${i}"][value="2"]`);
                        if (radioToSelect && !radioToSelect.checked) {
                            radioToSelect.click();
                        }
                    }
                    updateProgress();
                    checkCompletion();
                    console.log('[DEBUG] Auto-fill complete.');
                });

                // 'Í≤∞Í≥º Î≥¥Í∏∞' Î≤ÑÌäº ÌÅ¥Î¶≠ Ïãú
                calculateBtn.addEventListener('click', () => {
                    const result = calculateMBTI(); // 1. Í≥ÑÏÇ∞
                    mbtiResultInput.value = result; // 2. Ïà®Í≤®ÏßÑ ÌèºÏóê Í∞í ÏûÖÎ†•
                    localStorage.setItem('userMBTI', result); // 3. Î°úÏª¨ Ïä§ÌÜ†Î¶¨ÏßÄÏóê Ï†ÄÏû•
                    showResultModal(result); // 4. Î™®Îã¨ ÎùÑÏö∞Í∏∞
                    finalInputs.style.display = 'block'; // 5. 'Í≤∞Í≥º Ï†ÄÏû•' ÏÑπÏÖò Î≥¥Ïù¥Í∏∞
                    calculateBtn.style.display = 'none';
                    showResultBtn.style.display = 'inline-block';
                });
                
                showResultBtn.addEventListener('click', () => {
                    const result = localStorage.getItem('userMBTI');
                    if (result) showResultModal(result);
                });
                
                function updateProgress() {
                    const checkedRadios = document.querySelectorAll('input[type="radio"]:checked');
                    const answeredCount = checkedRadios.length;
                    const progress = (answeredCount / totalQuestions) * 100;
                    
                    progressBar.style.width = `${progress}%`;
                    progressBar.textContent = `${Math.round(progress)}%`;
                    questionCounter.textContent = `(${answeredCount} / ${totalQuestions})`;
                }

                function checkCompletion() {
                    const allQuestionsAnswered = document.querySelectorAll('input[type="radio"]:checked').length === totalQuestions;
                    calculateBtn.disabled = !allQuestionsAnswered; // 'Í≤∞Í≥º Î≥¥Í∏∞' Î≤ÑÌäº ÌôúÏÑ±Ìôî
                    
                    const writerFilled = nameInput.value.trim() !== '';
                    const dateFilled = dateInput.value !== '';
                    // 'Í≤∞Í≥º Ï†ÄÏû•' Î≤ÑÌäº ÌôúÏÑ±Ìôî
                    submitBtn.disabled = !(allQuestionsAnswered && writerFilled && dateFilled); 
                }

                // üåü [ÏàòÏ†ï] 100Î¨∏Ìï≠ Í∏∞Ï§ÄÏúºÎ°ú MBTI Í≥ÑÏÇ∞ Î°úÏßÅ
                function calculateMBTI() {
                    const scores = { E: 0, S: 0, T: 0, J: 0 };
                    
                    // app.jsÏùò questions.js Îç∞Ïù¥ÌÑ∞ Íµ¨Ï°∞Ïóê ÏùòÏ°¥
                    const eiEnd = 26; // E/I ÏßàÎ¨∏ 1~26 (26Í∞ú)
                    const snEnd = eiEnd + 25; // S/N ÏßàÎ¨∏ 27~51 (25Í∞ú)
                    const tfEnd = snEnd + 24; // T/F ÏßàÎ¨∏ 52~75 (24Í∞ú)
                    const jpEnd = tfEnd + 25; // J/P ÏßàÎ¨∏ 76~100 (25Í∞ú)

                    for (let i = 1; i <= jpEnd; i++) { // 100Î≤à Î∞òÎ≥µ
                        const radio = document.querySelector(`input[name="q${i}"]:checked`);
                        if(radio) {
                            const value = parseInt(radio.value);
                            
                            // üåü [ÏàòÏ†ï] 100Î¨∏Ìï≠ Í≤ΩÍ≥ÑÏóê ÎßûÍ≤å Ï†êÏàò Ìï©ÏÇ∞
                            if (i <= eiEnd) {         // 1-26
                                scores.E += value;
                            } else if (i <= snEnd) {  // 27-51
                                scores.S += value;
                            } else if (i <= tfEnd) {  // 52-75
                                scores.T += value;
                            } else if (i <= jpEnd) {  // 76-100
                                scores.J += value;
                            }
                        }
                    }

                    // Ïà®Í≤®ÏßÑ ÌèºÏóê Ï†êÏàò Ï†ÄÏû•
                    document.getElementById('scoreE').value = scores.E;
                    document.getElementById('scoreS').value = scores.S;
                    document.getElementById('scoreT').value = scores.T;
                    document.getElementById('scoreJ').value = scores.J;

                    // Í≤∞Í≥º Í≥ÑÏÇ∞
                    let result = '';
                    result += (scores.E > 0) ? 'E' : 'I';
                    result += (scores.S > 0) ? 'S' : 'N';
                    result += (scores.T > 0) ? 'T' : 'F';
                    result += (scores.J > 0) ? 'J' : 'P';
                    
                    // Ïà®Í≤®ÏßÑ ÌèºÏóê Ïù¥ÎØ∏ÏßÄ/ÏßÅÏóÖ/ÏΩîÎ©òÌä∏ Ï†ÄÏû•
                    const data = mbtiData[result] || mbtiData['DEFAULT'];
                    document.getElementById('mbtiJobInput').value = data.occupations;
                    document.getElementById('mbtiImageInput').value = data.image;
                    document.getElementById('mbtiCommentInput').value = data.comment;
                    
                    return result;
                }

                // üåü [ÏàòÏ†ï] Î™®Îã¨Ïóê ÏΩîÎ©òÌä∏ ÌëúÏãú Î°úÏßÅ Ï∂îÍ∞Ä
                function showResultModal(result) {
                    modalResultText.textContent = result;

                    const data = mbtiData[result] || mbtiData['DEFAULT'];
                    const imgEl = document.getElementById('modalResultImage');
                    const jobEl = document.getElementById('modalResultJob');
                    const commentEl = document.getElementById('modalResultComment'); // üëà ÏΩîÎ©òÌä∏ Element

                    if (data.image) {
                        imgEl.src = data.image;
                        imgEl.style.display = 'block';
                    } else {
                        imgEl.style.display = 'none';
                    }
                    jobEl.textContent = data.occupations;
                    commentEl.textContent = `"${data.comment}"`; // üëà ÏΩîÎ©òÌä∏ ÎÇ¥Ïö© Ï±ÑÏö∞Í∏∞

                    $('#resultModal').modal('show');
                }
                
                function initializeLikeButtons() {
                    const likeButtons = document.querySelectorAll('.like-button');
                    likeButtons.forEach(button => {
                        button.addEventListener('click', () => {
                            const messageId = button.dataset.id;
                            
                            // üåü [ÏàòÏ†ï] K8s ÌôòÍ≤ΩÏóêÏÑúÎäî '/like/:id' Í≤ΩÎ°úÎ•º ÏÇ¨Ïö© (app.js Í∏∞Ï§Ä)
                            fetch(`/like/${messageId}`, { method: 'POST' })
                                .then(response => {
                                    if (!response.ok) {
                                        throw new Error('Network response was not ok');
                                    }
                                    return response.json();
                                })
                                .then(updatedMessage => {
                                    const countSpan = document.getElementById(`likes-count-${messageId}`);
                                    if (countSpan) {
                                        countSpan.textContent = updatedMessage.likes;
                                    }
                                })
                                .catch(error => console.error('Error:', error));
                        });
                    });
                }
                
                initializeLikeButtons();
            });
